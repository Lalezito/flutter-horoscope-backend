# Railway Configuration for Zodiac Backend
# This ensures proper build with canvas and sharp dependencies

[build]
builder = "NIXPACKS"

[build.nixpacksPlan]
providers = ["nodejs"]

[build.nixpacks.phases.setup]
nixPkgs = ["nodejs", "python3", "pkg-config", "pixman", "cairo", "pango", "libjpeg", "giflib", "librsvg"]
aptPkgs = ["build-essential", "libcairo2-dev", "libpango1.0-dev", "libjpeg-dev", "libgif-dev", "librsvg2-dev"]

[build.nixpacks.phases.install]
cmds = [
  "npm config set legacy-peer-deps true",
  "npm install --no-package-lock",
  "npm rebuild canvas --build-from-source"
]

[build.nixpacks.phases.build]
cmds = []

[deploy]
startCommand = "npm run start"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
healthcheckPath = "/health"
healthcheckTimeout = 100
